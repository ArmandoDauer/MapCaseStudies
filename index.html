<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Municípios de Portugal — Contornos + Nomes</title>

  <!-- Leaflet via CDN (funciona bem no GitHub Pages).
       Se quiser 100% offline, dá para “vendorizar” depois. -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <style>
    html, body { height: 100%; margin: 0; }
    #map { height: 100%; background: #f6f7f9; }

    .mun-tooltip {
      background: rgba(255,255,255,0.95);
      border: 1px solid rgba(0,0,0,0.15);
      border-radius: 8px;
      padding: 4px 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
      font: 12px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: #111;
    }

    .panel {
      position: absolute;
      z-index: 999;
      top: 12px;
      left: 12px;
      background: rgba(255,255,255,0.95);
      border: 1px solid rgba(0,0,0,0.12);
      border-radius: 12px;
      padding: 10px 12px;
      font: 13px/1.3 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      box-shadow: 0 8px 24px rgba(0,0,0,0.10);
      max-width: 360px;
    }
    .panel b { display:block; margin-bottom:6px; }
    .panel .hint { color:#444; font-size:12px; }
    .panel .ok { margin-top:8px; font-size:12px; color:#065f46; display:none; }
    .panel .err { margin-top:8px; font-size:12px; color:#b91c1c; display:none; white-space:pre-wrap; }
  </style>
</head>

<body>
  <div id="map"></div>

  <div class="panel">
    <b>Municípios de Portugal</b>
    <div class="hint">
      • Passe o rato para ver o nome<br/>
      • Clique para abrir popup<br/>
      • Fonte: <code>data/municipios.geojson</code>
    </div>
    <div id="status-ok" class="ok">GeoJSON carregado com sucesso.</div>
    <div id="status-err" class="err"></div>
  </div>

  <script>
    const map = L.map('map', { zoomControl: true, preferCanvas: true });
    map.setView([39.5, -8.0], 7);

    const baseStyle = { color:'#1f2937', weight:1, opacity:0.9, fill:false };
    const hoverStyle = { color:'#111827', weight:2, opacity:1 };

    function getMunicipioName(props) {
      // Ajuste aqui se seu GeoJSON tiver um campo específico:
      return (
        props?.concelho ||
        props?.municipio ||
        props?.NAME_2 ||
        props?.name ||
        props?.NOME ||
        props?.DESIGNA ||
        'Município'
      );
    }

    async function loadMunicipios() {
      const okEl = document.getElementById('status-ok');
      const errEl = document.getElementById('status-err');

      try {
        const res = await fetch('data/municipios.geojson', { cache: 'no-store' });
        if (!res.ok) throw new Error(`HTTP ${res.status} ao buscar data/municipios.geojson`);
        const geojson = await res.json();

        const layer = L.geoJSON(geojson, {
          style: baseStyle,
          onEachFeature: (feature, lyr) => {
            const nome = getMunicipioName(feature.properties);

            lyr.bindTooltip(nome, {
              className: 'mun-tooltip',
              sticky: true,
              direction: 'top',
              opacity: 1
            });

            lyr.bindPopup(`<b>${nome}</b>`);

            lyr.on('mouseover', () => lyr.setStyle(hoverStyle));
            lyr.on('mouseout', () => lyr.setStyle(baseStyle));
          }
        }).addTo(map);

        map.fitBounds(layer.getBounds(), { padding: [12, 12] });
        okEl.style.display = 'block';
      } catch (e) {
        console.error(e);
        errEl.textContent =
          'Erro ao carregar o GeoJSON.\n' +
          'Verifique se o ficheiro existe em: data/municipios.geojson\n\n' +
          String(e);
        errEl.style.display = 'block';
      }
    }

    loadMunicipios();
  </script>
</body>
</html>
